import os
import sys

sys.path.append(os.path.abspath(os.path.dirname(__file__) + "/.."))
print(f"DEBUG PATH: {sys.path}")
import kalkulator_pkg.regression_solver

print(f"DEBUG FILE: {kalkulator_pkg.regression_solver.__file__}")

from kalkulator_pkg.function_manager import find_function_from_data

tests = [
    # 1. Reynolds
    (
        "Reynolds",
        [
            ([1, 1, 1, 1], 1),
            ([10, 2, 5, 2], 50),
            ([5, 100, 0.1, 0.5], 100),
            ([2, 50, 2, 10], 20),
            ([8, 10, 2, 4], 40),
            ([4, 2, 3, 6], 4),
            ([10, 10, 10, 10], 100),
            ([1, 0.5, 4, 0.2], 10),
            ([7.5, 2, 2, 3], 10),
            ([9, 3, 1, 1], 27),
        ],
        ["rho", "u", "L", "mu"],
        "rho*u*L/mu",
    ),
    # 2. Coulomb
    (
        "Coulomb",
        [
            ([1, 1, 1], 9000),
            ([1, 1, 3], 1000),
            ([2, 2, 2], 9000),
            ([5, 4, 10], 1800),
            ([2, 5, 10], 900),
            ([1, 1, 10], 90),
            ([3, 3, 3], 9000),
            ([2, 2, 6], 1000),
            ([10, 10, 100], 90),
            ([0.5, 4, 2], 4500),
        ],
        ["q1", "q2", "r"],
        "9000*q1*q2/r^2",
    ),
    # 3. Damped
    (
        "Damped",
        [
            ([0], 1),
            ([0.5], 0.327683777429),
            ([1], -0.153091769448),
            ([1.570796326795], -0.207879576351),
            ([2], -0.088461044565),
            ([3.14159265359], 0.043213918264),
            ([0.25], 0.684136808331),
            ([0.785398163397], 0),
            ([1.2], -0.222106963872),
            ([4], -0.002664058249),
        ],
        ["t"],
        "exp(-t)*cos(2*t)",
    ),
    # 4. Entropy
    (
        "Entropy",
        [
            ([1], 0),
            ([2.718281828459], -13.591409142295),
            ([2], -6.931471805599),
            ([10], -115.129254649702),
            ([0.5], 1.732867951399),
            ([4], -27.725887222397),
            ([3], -16.479184330021),
            ([5], -40.235947810852),
            ([1.5], -3.040988310534),
            ([0.1], 1.151292546497),
        ],
        ["x"],
        "-5*x*log(x)",
    ),
    # 5. Cone
    (
        "Cone",
        [
            ([3, 10], 94.247779607693),
            ([1, 3], 3.141592653589),
            ([6, 2], 75.398223686155),
            ([2, 6], 25.132741228718),
            ([2, 9], 37.699111843077),
            ([4, 3], 50.265482457436),
            ([1, 1], 1.047197551196),
            ([3, 1], 9.424777960769),
            ([5, 6], 157.079632679489),
            ([0.5, 12], 3.141592653589),
        ],
        ["r", "h"],
        "1/3*pi*r^2*h",
    ),
    # 6. Spacetime
    (
        "Spacetime",
        [
            ([10, 2, 2, 2], -88),
            ([0, 3, 4, 0], 25),
            ([1, 1, 1, 1], 2),
            ([5, 0, 0, 0], -25),
            ([2, 5, 5, 5], 71),
            ([4, 4, 4, 4], 32),
            ([3, 0, 0, 0], -9),
            ([6, 1, 1, 1], -33),
            ([2, 10, 0, 0], 96),
            ([5, 3, 4, 0], 0),
        ],
        ["t", "x", "y", "z"],
        "-t^2+x^2+y^2+z^2",
    ),
    # 7. Mechanical Energy
    (
        "MechEnergy",
        [
            ([1, 2, 0], 2),
            ([1, 0, 1], 9.8),
            ([2, 2, 1], 23.6),
            ([10, 10, 10], 1480),
            ([5, 4, 2], 138),
            ([0.5, 10, 5], 49.5),
            ([1, 1, 1], 10.3),
            ([4, 5, 0], 50),
            ([2, 0, 10], 196),
            ([10, 2, 2], 216),
        ],
        ["m", "v", "h"],
        "0.5*m*v^2+9.8*m*h",
    ),
    # 8. Sinc
    (
        "Sinc",
        [
            ([1], 0.841470984807),
            ([2], 0.454648713412),
            ([3.14159265359], 0),
            ([4.712388980384], -0.212206590789),
            ([1.570796326795], 0.636619772367),
            ([0.5], 0.958851077208),
            ([0.1], 0.998334166468),
            ([10], -0.054402111088),
            ([6], -0.046569249699),
            ([0.001], 0.999999833333),
        ],
        ["x"],
        "sin(x)/x",
    ),
    # 9. Hagen-Poiseuille
    (
        "HagenPoiseuille",
        [
            ([1, 1, 1, 1], 100),
            ([1, 1, 1, 2], 6.25),
            ([2, 2, 2, 1], 800),
            ([0.1, 10, 10, 1], 1000),
            ([1, 1, 1, 10], 0.01),
            ([5, 2, 2, 2], 125),
            ([1, 1, 1, 3.162277660168], 1),
            ([3, 1, 1, 1], 300),
            ([1, 50, 0.02, 1], 100),
            ([1, 1, 1, 0.5], 1600),
        ],
        ["mu", "L", "Q", "r"],
        "100*mu*L*Q/r^4",
    ),
    # 10. Sphere
    (
        "Sphere",
        [
            ([1], 4.188790204786),
            ([3], 113.097335529232),
            ([6], 904.778684233860),
            ([2], 33.510321638291),
            ([0.5], 0.523598775598),
            ([10], 4188.790204786390),
            ([1.5], 14.137166941154),
            ([4], 268.082573106329),
            ([5], 523.598775598298),
            ([0.1], 0.004188790204),
        ],
        ["r"],
        "4/3*pi*r^3",
    ),
]

for name, data, params, expected in tests:
    try:
        success, func_str, _, mse = find_function_from_data(data, params)
        print(f"--- {name} ---")
        print(f"Result: {func_str}")
        print(f"Expected: {expected}")
        # Simplified check
        exp_clean = expected.replace(" ", "").replace("*", "")
        res_clean = func_str.replace(" ", "").replace("*", "") if func_str else ""
        if any(key in res_clean for key in exp_clean.split("+")):
            print("STATUS: PASS")
        else:
            print("STATUS: CHECK")
    except Exception as e:
        print(f"--- {name} ---")
        print(f"STATUS: CRASH - {e}")
    print()
